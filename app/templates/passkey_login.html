{% extends "base.html" %}

{% block content %}

<link rel="stylesheet" href="https://unpkg.com/@corbado/web-js@2/dist/bundle/index.css" />
<script src="https://unpkg.com/@corbado/web-js@2/dist/bundle/index.js"></script>

<div style="max-width: 500px; margin: 4rem auto;">
    <!-- Logo/Header -->
    <div style="text-align: center; margin-bottom: 2rem;">
        <h1 style="color: var(--accent); font-size: 2.5rem; margin-bottom: 0.5rem;">
            <i class="fa-solid fa-chart-line"></i> PyCashFlow
        </h1>
        <p style="color: var(--text-secondary);">Sign in with your passkey</p>
    </div>

    <!-- Passkey Login Card -->
    <div class="metric-card" style="padding: 2rem;">
        <div style="text-align: center; margin-bottom: 1.5rem;">
            <div style="width: 4rem; height: 4rem; background: linear-gradient(135deg, var(--accent), #60a5fa); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin: 0 auto 1rem;">
                <i class="fa-solid fa-key"></i>
            </div>
            <h2 style="color: var(--text-primary); font-size: 1.5rem; margin-bottom: 0.5rem;">
                Passkey Authentication
            </h2>
            <p style="color: var(--text-secondary); font-size: 0.875rem;">
                Use your device's biometric authentication or security key
            </p>
        </div>

        <div id="corbado-auth"></div>

        <!-- Alternative login link -->
        <div style="margin-top: 1.5rem; text-align: center; padding-top: 1.5rem; border-top: 1px solid var(--border);">
            <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">Prefer traditional login?</p>
            <a href="{{url_for('auth.login')}}" style="color: var(--accent); text-decoration: none; font-weight: 600;">
                <i class="fa-solid fa-right-to-bracket"></i>
                Sign In with Email & Password
            </a>
        </div>
    </div>
</div>

<script type="module">
    const CORBADO_PROJECT_ID = "{{ project_id }}";
    const FRONTEND_URI = "{{ frontend_uri }}";

    await Corbado.load({
        // If you want to set other options like styling and translations check the full list of options at
        // https://docs.corbado.com/frontend-integration/ui-components/corbadoprovider#api-reference
        projectId: CORBADO_PROJECT_ID,
        frontendApiUrl: FRONTEND_URI,

        darkMode: "on",
        // We activated short-term session cookie dropping here because you need it for multi-page
        // applications (MPA). If you implement a single-page application (SPA) you can most likely
        // deactivate this option.
        setShortSessionCookie: true,
    });

    const authElement = document.getElementById("corbado-auth");
    Corbado.mountAuthUI(authElement, {
        onLoggedIn: () => (window.location.href = "/passkey_login_post"),
    });
</script>

{% endblock %}
